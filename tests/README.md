# Newman Postman Collection Test Configuration

## Introduction

# Newman Jenkins API Testing

For more information on Newman CLI integration , checkout the [Newman Command Line Integration](https://www.getpostman.com/docs/v6/postman/collection_runs/command_line_integration_with_newman).

For more information on Newman Postman API testing , checkout the [Postman Sandbox API Reference](https://www.getpostman.com/docs/v6/postman/scripts/postman_sandbox_api_reference).

# Postman Collection JSON

At it's core, Newman executes a collection JSON that can either be generated by Postman's GUI or manually created JSON files that follow the same structure. In this collection, users can define global variables , pre-request scripts, and API calls to be executed in support of analyzing response JSON and other micro-service behavior.


# Configuration File JSON

Though the collection JSON can house all our tests and unique configurations, doing so would result in a massive file that is difficult to maintain. However, to add flexibility to your test environment Newman provides an option to specify a configuration JSON file as a flag during CLI execution. With this reference, users can specify hosts, desired request bodies, and define the expected response from the API call for any given request.

Sample Command:
`newman run test.json  -d config.json`


Sample Config JSON:
```
[
  {
    "host": "localhost:8080",
    "testData": [
      {
        "testName": "health check",
        "testNumber": 0,
        "expectedCountries": []
      },
      {
        "testName": "USAPointCheck",
        "testNumber": 1,
        "requestBody": {
          "wkt": "POINT(-89.45973 30.230595)"
        },
        "expectedCountries": [
          {
            "OBJECTID": 209,
            "GENC_2": "US",
            "GENC_3": "USA",
            "GENC_NUM": "840",
            "COUNTRY": "United States"
          }
        ]
      }
  ]
```

The structure/contents of your configuration file is limited only to it having to be valid JSON.

# Configuration Reference

In the collection JSON, this configuration file can be referenced inside `exec` blocks using the `postman` library.

Example:
`"let testData = pm.iterationData.get(\"testData\")"`

The sample above will result in an array of objects mirroring what was defined on the `testData` field of the configuration file.

# Variable Definition JSON

The following snippet reflects an example of how one would define a variable to be referenced globally in the collection JSON.

```
"variable": [{
    "key": "testNumber",
    "value": 0,
    "type": "int"
  },
  {
    "key": "requestBody",
    "value": "",
    "type": "string"
  }
],
```

# Pre-request  JSON

The following snippet reflects an example of how one would define a pre-request script. These scripts are executed before each API request. An example of their use can include setting up a request body variable before the next API test.

```
"event": [{
  "listen": "prerequest",
  "script": {
    "type": "text/javascript",
    "exec": [
      "testNumber = pm.variables.get(\"testNumber\");",
      "let testData = pm.iterationData.get(\"testData\")",
      "let requestBody = JSON.stringify(testData[testNumber].requestBody)",
      "++testNumber",
      "pm.variables.set(\"testNumber\",testNumber);",
      "pm.variables.set(\"requestBody\",requestBody);"
    ]
  }
}],
```

# Request & Post-Request  JSON

The following snippet reflects an example of how one would define a request/post-request script. In this case your API call is executed and you now have access to a response object and header for analysis.

```
{
  "name": "Point Check",
  "event": [
    {
      "listen": "test",
      "script": {
        "id": "2b368fb0-0268-4c8a-974e-bc10439be682",
        "type": "text/javascript",
        "exec": [
          "pm.test(\"Status code is 200\",function () {",
          "      pm.response.to.have.status(200);",
          "});",
          "",
          "pm.test(\"Check USA Point\", function () {",
          "let countryRows = pm.response.json().rows",
          "let testData = pm.iterationData.get(\"testData\")",
          "let expectedCountries = testData[testNumber-1].expectedCountries",
          "pm.expect(expectedCountries).to.have.deep.members(countryRows);",
          "});"
        ]
      }
    }
  ],
  "request": {
    "method": "POST",
    "header": [
      {
        "key": "Content-Type",
        "value": "application/json"
      }
    ],
    "body": {
      "mode": "raw",
      "raw": "{{requestBody}}"
    },
    "url": {
      "raw": "http://{{host}}/api/countries",
      "protocol": "http",
      "host": [
        "{{host}}"
      ],
      "path": [
        "api",
        "countries"
      ]
    }
  },
  "response": []
}
```
